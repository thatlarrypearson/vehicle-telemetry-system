# Examples - Data Analysis

To avoid automation limitations working with [jupyter notebooks](https://jupyter.org/), the example notebook has been reworked to be a more generalized solution to initial data analysis.

## ```initial_data_analysis.sh```

This Linux ```bash``` shell script also runs on Windows (using [Windows Subsystem for Linux (WSL)](https://docs.microsoft.com/en-us/windows/wsl/) [Ubuntu](https://ubuntu.com/wsl) or [git for Windows](https://gitforwindows.org/)).

```initial_data_analysis.sh``` takes ```json``` vehicle data files collected by [```telemetry_obd.obd_logger```](https://github.com/thatlarrypearson/telemetry-obd) and automatically creates a series of basic data analytics artifacts.

By editing the ```bash``` shell program, fine grained control can be maintaned over which artifacts get created.  Additionally, shell variables are set to match the file system layout of the developer.  These variables may need to be changed to match the file system layout of the target machine.

### ```initial_data_analysis.sh``` Usage

```bash
$ bash examples/initial_data_analysis.sh
examples/initial_data_analysis.sh: USAGE:
  telemetry-obd-output-file_1.json [telemetry-obd-output-file_2.json ... telemetry-obd-output-file_n]
Environment Variables:
  CONFIG_FILE: configuration file used by telemetry_obd.obd_logger to collect data.

$ export CONFIG_FILE=../telemetry-obd/config/C4HJWCG5DL0000.ini
$ 
$ bash examples/initial_data_analysis.sh ../telemetry-obd/data/C4HJWCG5DL0000/*.json
$
```

Output is placed in a directory called ```analysis``` in the current working directory.

### ```initial_data_analysis.sh``` Limitations

One important assumption made in these analysis programs is ```JSON``` data files generated by ```telemetry_obd.obd_logger``` are processed in time order.  To ensure this, input files to ```obd_log_to_csv.obd_log_to_csv``` are sorted to ensure correct timestamp ordering.

## ```initial_data_analysis.py```

Initial Python Pandas data analysis for CSV files generated by obd_log_to_csv,
csv_to_ratio_csv and csv_to_delta_csv.

### ```initial_data_analysis.py``` Usage

```bash
$ python3.10 examples/initial_data_analysis.py --help
usage: initial_data_analysis [-h] [--verbose]
                          [--output_directory OUTPUT_DIRECTORY]
                          [--numeric_columns NUMERIC_COLUMNS] [--forward_fill]
                          [--backward_fill] [--general_info] [--general_stats]
                          [--correlations] [--covariances] [--line_graphs]
                          [--normalized_line_graphs] [--histograms]
                          [--scatter_plots] [--3d_scatter_plots]
                          [--kernel_density] [--plots_to_screen]
                          [--no_plots_to_files]
                          files [files ...]

Initial Python Pandas data analysis for CSV files generated by obd_log_to_csv,
csv_to_ratio_csv or csv_to_delta_csv.

positional arguments:
  files                 path for obd_log_to_csv, csv_to_ratio_csv or
                        csv_to_delta_csv generated files.

optional arguments:
  -h, --help            show this help message and exit
  --verbose             Turn verbose output on. Default is off.
  --output_directory OUTPUT_DIRECTORY
                        Output file path.
  --numeric_columns NUMERIC_COLUMNS
                        Limit analysis to these columns otherwise use all
                        columns. Format: col1,col2,col3,...,coln
  --forward_fill        Fill NaN values with the closest non-NaN value from
                        above
  --backward_fill       Fill NaN values with the closest non-NaN value from
                        below
  --general_info        Output the General Information section
  --general_stats       Output the General Statistics section
  --correlations        Output the Correlations section
  --covariances         Output the Covariances section
  --line_graphs         Output the Line Graphs section
  --normalized_line_graphs
                        Output the Normalized Line Graphs section
  --histograms          Output the Histogram Graphs section
  --scatter_plots       Output the Scatter Plots section
  --3d_scatter_plots    Output the 3D scatter Plots section
  --kernel_density      Output the 2D kernel density estimation (KDE) section
  --plots_to_screen     Output Plots/Graphs to the screen
  --no_plots_to_files   Don't save any Plots/Graphs to disk

$
```

### ```initial_data_analysis.py``` Limitations

There is an implicit assumption that all OBD commands represented as columns in the input file are numeric (not string) with the exception  of ```iso_ts_pre```, ```iso_ts_post``` and ```duration```.  Date/time values such as ```iso_ts_pre```, ```iso_ts_post``` and ```duration``` are treated as date/time objects in the evaluation software.  Analysis will fail of other columns being processed contain strings.  Blank (Null, None or NaN) CSV field values are OK and get converted into NaN values in Python Pandas.

When running on large data sets with a large number of columns, this program may run out of system resources (possible memory leak).  The problem occurs while running under native Windows (including Anaconda) and some Linux distributions.  It didn't happen under the Ubuntu version of Windows Subsystem for Linux (WSL).  

```bash
$ bash examples/initial_data_analysis.sh $(find ../telemetry-obd/data/C4HJWCG5DL0000 -name '*-utc.json' -print  | grep -v TEST)
Fail to create pixmap with Tk_GetPixmap in TkImgPhotoInstanceSetSize
Following Command Failed With Code: 3
python3.10 ../telemetry-obd-log-to-csv/examples/initial_data_analysis.py initial_data_analysis.csv
$
$ ls -l initial_data_analysis
total 184
-rw-r--r-- 1 human 197609 33872 Mar  4 10:53 correlations.txt
-rw-r--r-- 1 human 197609 38232 Mar  4 10:53 covariances.txt
-rw-r--r-- 1 human 197609  8202 Mar  4 10:52 general_info.txt
-rw-r--r-- 1 human 197609  5313 Mar  4 10:53 general_stats.txt
drwxr-xr-x 1 human 197609     0 Mar  4 11:05 histogram/
drwxr-xr-x 1 human 197609     0 Mar  4 10:57 line/
drwxr-xr-x 1 human 197609     0 Mar  4 11:04 line-normalized/
drwxr-xr-x 1 human 197609     0 Mar  4 11:25 scatter2/
$
```

In the above example, ```examples/initial_data_analysis.py``` failed in ```--scatter_plots``` while trying to create and save serially OBD commands squared number of plots.  34 commands * 33 commands is 1,122 graphs.  The program failed on the 255-th plot.

If this happens, limit the number of columns being analyzed by specifying a subset of columns using the ```--numeric_columns``` argument.  Another alternative is to make multiple runs of ```examples/initial_data_analysis.py``` where each run only generates a single family of plots.

Also note that the number of graphs for 2D and 3D graphs will generate plots numbering the square or cube of the columns.  The plots can consume large amounts of disk space.

## ```load_config_file.py```

Given a ```telemetry_obd.obd_logger``` config file, produce a list of the OBD
commands listed in the specified configuration section.

### ```load_config_file.py``` Usage

```bash
$ python3.10 examples/load_config_file.py --help
usage: obd_log_evaluation [-h] [--verbose] [--startup] [--housekeeping]
                          [--cycle]
                          config_file

Given a telemetry_obd.obd_logger config file, produce a list of the OBD
commands listed in the specified configuration section.

positional arguments:
  config_file     path for obd_logger configuration file.

optional arguments:
  -h, --help      show this help message and exit
  --verbose       Turn verbose output on. Default is off.
  --startup       Output startup OBD commands. Default is off.
  --housekeeping  Output housekeeping OBD commands. Default is off.
  --cycle         Output cycle OBD commans. Default is off.

$
```

### ```load_config_file.py``` Limitations

There is an implicit assumption that all OBD commands in ```telemetry_obd.obd_logger``` configuration file sections ```housekeeping``` and ```cycle``` only produce numeric values and do not produce string values.  When this is not true, downstream procuessing such as ```examples/initial_data_analysis.py``` are likely to fail.
