# Telemetry System Boot and Application Startup Counter

Increments and returns the *system boot* and *application start* counters for use by other telemetry applications.  Capabilities are exposed to ```bash``` Linux shell scripts and Python applications.

## Goals

- Move configuration information (e.g. VIN based ```obd_logger``` files) and data generated by telemetry loggers out of source code directories.
- Mitigate file name issues when Raspberry Pi system clocks are unreliable.
- Improve traceability through the use of durable invariant data file naming conventions.
- Unique file names when using multiple vehicles with multiple data collection computers (requires computer names are unique and invariant as well).

## Installation

This module installs automatically during [Python Project Software Build and Installation](./README.md/#python-project-software-build-and-installation).  Installation into an in-vehicle Raspberry Pi data collection environment is described in [Raspberry Pi Data Collector](./README-rpdc.md).

## Modules - Sensors, Common Functions, Data Management, Data Analysis and Raspberry Pi Configuration

- Vehicle Sensor Modules
  - [engine](./README-engine.md) (OBD)
  - [location](./README-location.md) (GPS)
  - [motion](./README-motion.md) (IMU)
  - [weather](./README-weather.md) (WTHR)
  - [trailer](./README-trailer.md) (TRLR)

- **Common Functions**
  - [utilities](./README-utility.md) (UTILITY)
  - **[audit](./README-audit.md) (COUNTER)**

- Data Aggregation and Analysis
  - [aggregation](./README-aggregation.md) (JSON2CSV)
  - [notebooks](./README-notebooks.md) (ANALYSIS)

- Data Collection System Configuration

    This section covers preparing a Raspberry Pi system for in vehicle use as a headless data collection system.

  - [Raspberry Pi Data Collector](./README-rpdc.md)

## Data File Naming Conventions

These conventions apply to data files collected on the vehicle mounted Raspberry Pi (3, 4 or 5) SBC (single board computer).

- **engine** module consisting of ```telemetry_obd.obd_logger``` and ```telemetry_obd.obd_command_tester``` applications:

```python
  "{base_path}/{HOST_ID}/{HOST_ID}-{boot_count_string}-{application_id}-{vin}-{counter_string}.json"
```

- Everything else:

```python
  "{base_path}/{HOST_ID}/{HOST_ID}-{boot_count_string}-{application_id}-{counter_string}.json"
```

Where:

- **```base_path```** defaults to the home directory (```${HOME}```) of the vehicle mounted Raspberry Pi (3, 4 or 5) SBC (single board computer) user executing the data collection module(s).
- **```HOST_ID```** is the host name of the vehicle mounted Raspberry Pi (3, 4 or 5) SBC (single board computer).  See bash shell command ```hostname```.
- **```boot_count_string```** is a zero padded string containing a number that is incremented every time the vehicle mounted Raspberry Pi (3, 4 or 5) SBC (single board computer) is booted.
- **```vin```** is the vehicle manufacturer's Vehicle Identification Number or VIN
- **```application_id```** is an identifier for each data collection application type.
  - ```obd```, ```obd-cmd-test``` (engine)
  - ```gps``` (location)
  - ```wthr``` (weather)
  - ```imu``` (motion)
  - ```trlr``` (trailer)
- **```counter_string```** is set to 0 at boot and then incremented each time the application restarts.

## Adding Additional Sensors

Use the  existing [Data File Naming Conventions](#data-file-naming-conventions) when adding additional sensors.  Select an abbreviated version of your sensor name that hasn't been already used as an ```application_id```.

Add your new ```application_id``` to the ```APPLICATION_LIST``` list variable in the source code file ```vehicle-telemetry-system/src/tcounter/common.py```.

```python
# Known application shortcuts
APPLICATION_LIST = ['obd', 'obd-cmd-test', 'gps', 'wthr', 'imu', 'trlr', ]
```

Once the addition has been made, remake the package following the [Python Project Software Build and Installation](./README.md/#python-project-software-build-and-installation) instructions.

## Command Line Usage ```tcounter.boot_counter```

```bash
$ uv run -m tcounter.boot_counter --help
usage: boot_counter.py [-h] [--boot_count_file_location] [--current_boot_count] [--version]

Telemetry Boot Counter

options:
  -h, --help            show this help message and exit
  --boot_count_file_location
                        Print boot count file location and exit.
  --current_boot_count  Print current boot count and exit.
  --version             Print version number and exit.
$
```

## Command Line Usage ```tcounter.app_counter```

```bash
$ uv run -m tcounter.app_counter --help
usage: app_counter.py [-h] [--app_count_file_location] [--current_app_count] [--version] application_id

Telemetry Application Start Counter

positional arguments:
  application_id        Application Identifier must be one of ['obd', 'gps', 'wthr', 'imu'].

options:
  -h, --help            show this help message and exit
  --app_count_file_location
                        Print application start count file location and exit.
  --current_app_count   Print current application start count and exit.
  --version             Print version number and exit.
$
```

## Function Usage ```get_output_file_name```

Increments the *application counter* and then returns the full path for a module's output data file.

```python
def get_output_file_name(application_id:str, vin:str=None, base_path=BASE_PATH) -> Path:
```

Application ID's are found in ```vehicle-telemetry-system/src/tcounter/common.py``` in the list definition below:

```python
# Known application shortcuts
APPLICATION_LIST = ['obd', 'obd-cmd-test', 'gps', 'wthr', 'imu', 'trlr', ]
```

When adding a new data collection module, the new application ID should be added to this list.

```vin``` defaults to None and should only be used by the engine module.

```base_path``` defaults to ```BASE_PATH``` and is found in ```vehicle-telemetry-system/src/tcounter/common.py```.

## LICENSE

[MIT](LICENSE.md)
